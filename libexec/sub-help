#!/usr/bin/env bash
# Print and format command usage, summary, and help info
# Usage: sub help [<command>]

set -e

base="$(basename $0)"
base="${base%-help}"
command="$1"
case "$command" in
"" ) 
   printf "Usage:\n\n%-5s%-60s\n\n" "" "$($base helper usage $base)"
   printf "Summary:\n\n%-5s%-60s\n\n" "" "$($base helper summary $base)"
   printf "%s\n\n" "$($base commands)"
   printf "%s\n\n" "See '$base help <command>' for information on a specific command."
   ;;
* )
   usage="$($base helper usage $command)"

   if [[ ! -x "$_SUB_ROOT/libexec/$base-$command" ]]; then
      echo "$base: no such command '$command'" >&2
      exit 1
   elif [[ -n "$usage" ]]; then
      summary="$($base helper summary $command)"
      if [[ -n $summary ]]; then
         printf "Summary:\n\n%-5s%s\n\n" "" "$summary"
      fi
      
      printf "Usage:\n\n%-5s%s\n\n" "" "$usage"

      help="$($base helper help $command)"
      if [[ -n $help ]]; then
         printf "Help:\n\n%s\n\n" "$help"
      fi

   else
      printf "Usage:\n\n%-5s%s\n\n" "" "Command not documented"
   fi
esac
